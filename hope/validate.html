<!DOCTYPE html>
<html lang="zh-Hans-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="description" content="LuLu UI hope主题中文文档，面向移动端开发，阅文集团前端团队荣誉出品。本页面文档内容关于Validate表单验证">
<meta name="keywords" content="LuLu UI, 中文文档, UI框架, UI组件库, LuLu, Web, 前端, Validate表单验证">
<title>LuLu UI hope主题中文文档 &raquo; Validate表单验证</title>
<link rel="stylesheet" href="https://qidian.gtimg.com/lulu/hope/ui/ui.css">
<link rel="stylesheet" href="../hope/assets/css/mockup.css">
<script type="module" src="../hope/assets/js/code-run.js"></script>
</head>
<body>
	<input id="asideCheck" type="checkbox" class="aside-checkbox"><label for="asideCheck" class="aside-label"><svg width="24" height="24"><use xlink:href="#icon-bars"></use></svg></label>
	<header class="header">
		<a href="../" accesskey="1" class="logo-a" data-theme="hope"><h1 class="logo">LuLu UI Edge版中文文档 &raquo; Validate表单验证</h1></a>
		<div class="header-right">
			<ui-drop id="dropDoc" target="dropDocData" class="ui-droplist-arrow mr20">文档</ui-drop>
			<datalist id="dropDocData">
				<option href="">文档</option>
				<option href="https://www.zhangxinxu.com/sp/lulu/guide/edge/">教程</option>
			</datalist>
			<select id="selectTheme" class="select-theme" is="ui-select">
				<option value="peak">Peak主题</option>
			    <option value="pure">Pure主题</option>
			    <option value="edge">Edge主题</option>
				<option value="hope" selected>Hope主题</option>
			</select>
			<a href="https://github.com/yued-fe/lulu" target="_blank" rel="noopener nofollow" class="blue ml15">Github➹</a>
		</div>
	</header>


<style>
form { font-family: "Helvetica Neue","Helvetica","Arial",sans-serif;  }
ui-contents label {
    line-height: 3rem;
    align-self: start;
}
</style>

<div class="main">
    <!-- 主内容 -->
    <main class="section_main">
    	<h2 class="section_title">Validate表单验证</h2>
        <!-- 详细内容 -->
        <article>
            <h3>安装与调用</h3>
            <p>引用下面CSS：</p>
            <pre>&lt;link rel="stylesheet" href="https://qidian.gtimg.com/lulu/hope/ui/Validate/index.css"&gt;</pre>
            <p>JS为：</p>
            <pre>&lt;script type="module" src="https://qidian.gtimg.com/lulu/hope/ui/Validate/index.js"&gt;&lt;/script&gt;</pre>
            <p>或者<code>import</code>导入：</p>
            <pre>&lt;script&gt;
    import Validate from 'https://qidian.gtimg.com/lulu/hope/ui/Validate/index.js';
&lt;/script&gt;</pre>

            <h3>基础功能演示</h3>
            <p>基于HTML5规范的表单验证交互组件。依赖 <a href="./errortip.html">ErrorTip 组件</a>。</p>
            <ul>
                <li>内置type类型包括：<code>email</code>, <code>tel</code>, <code>url</code>, <code>zipcode</code>, <code>number</code>, <code>date</code>, <code>hour</code>, <code>minute</code>, <code>time</code>。</li>
                <li>自定义正则表达式，使用原生 HTML 属性<code>pattern</code>，例如：<code>pattern="^\d{16}$"</code>。</li>
                <li>范围超出，如数值输入，数值范围选择，以及日期和时间的起止限制，使用原生 <code>min</code>, <code>max</code>, <code>step</code> 属性。</li>
                <li>内置计数和计数验证功能，使用原生 <code>maxlength</code>, 以及 <code>minlength</code>。内容长度超出提示的时候会自动选择超出部分的文字。</li>
                <li>支持指定提示信息和自定义验证方法，具体<a href="#labelCount">参见这里</a>。</li>
            </ul>

            <h4>测试兼演示</h4>
            <p>下面表单采用组件默认验证交互，即点击“提交”按钮后开启即时验证，所有有误内容标红，但是出错提示只会出现在第一个或当前激活的控件上。</p>

            <code-run open title="复杂表单验证">
                <div slot="preview" style="--ui-gap: 1rem;">
                    <form id="validateForm" class="ui-grid">
                        <ui-contents>
                            <label>邮箱<span class="red abs">*</span></label>
                            <div>
                                <input type="email" class="ui-input" name="email" required>
                                <span class="gray f14">type='email', required, 复制：a.b.c@qq.com</span>
                            </div>
                        </ui-contents>
                        <ui-contents>
                            <label>手机号<span class="red abs">*</span></label>
                            <div>
                                <input type="tel" name="tel" is="ui-input" required placeholder="会自动过滤非必要字符">
                                <span class="gray f14">type='tel', required, 复制：132-0803-3621</span>
                            </div>
                        </ui-contents>
                        <ui-contents>
                            <label for="inputBank">银行账户<span class="red abs">*</span></label>
                            <div>
                                <input id="inputBank" class="ui-input" required pattern="^\d{16}$">
                                <span class="gray f14">pattern="^\d{16}$", required, 复制：0000111100001111</span>
                            </div>
                        </ui-contents>
                        <ui-contents>
                            <label>每日限额<span class="red abs">*</span></label>
                            <div>
                                <input type="number" class="ui-input w100" min="5" max="500" size="5" required placeholder="输入数值">
                                <span class="gray f14">type='number', min='5', max='500', required</span>
                            </div>
                        </ui-contents>
                        <ui-contents>
                            <label>密码<span class="red abs">*</span></label>
                            <div>
                                <input type="password" id="inputPwd" class="ui-input" required>
                                <span class="gray f14">required</span>
                            </div>
                        </ui-contents>
                        <ui-contents>
                            <label>确认密码<span class="red abs">*</span></label>
                            <div>
                                <input type="password" id="inputPwdAgain" class="ui-input" required>
                                <span class="gray f14">required</span>
                            </div>
                        </ui-contents>
                        <ui-contents>
                            <span>您的性别<span class="red abs">*</span></span>
                            <div>
                                <input type="radio" id="radioMale" name="validateRadio" is="ui-radio" required><label class="mr20 ml5" for="radioMale">男士</label>
                                <input type="radio" id="radioFemale" name="validateRadio" is="ui-radio" required><label for="radioFemale" class="ml5">女士</label>
                            </div>
                        </ui-contents>
                        <ui-contents>
                            <label>个人网站</label>
                            <div>
                                <input type="url" class="ui-input">
                                <span class="gray f14">type='url'</span>
                            </div>
                        </ui-contents>
                        <ui-contents>
                            <label>所在城市<span class="red abs">*</span></label>
                            <div>
                                <select required is="ui-select">
                                    <option value="">请选择</option>
                                    <option value="sz">深圳</option>
                                    <option value="sh">上海</option>
                                    <option value="bj">北京</option>
                                    <option value="cd">成都</option>
                                    <option value="wh">武汉</option>
                                </select>
                                <span class="gray f14">required</span>
                                <span id="cityError" class="red ml20 f14"></span>
                            </div>
                        </ui-contents>
                        <ui-contents>
                            <label>请假时间</label>
                            <div>
                                <input type="date-range" value="2023-09-08" min="2023-07-10" max="2023-12-01" is="ui-datetime">
                                <span class="gray f14">min="2023-07-10", max="2023-12-01"</span>
                            </div>
                        </ui-contents>
                        <ui-contents>
                            <label for="adminName">姓名</label>
                            <div>
                                <div class="ui-input-x" style="max-width:300px;">
                                    <input id="adminName" is="ui-input" name="adminName" maxlength="20" lang="zh">
                                </div>
                                <span class="gray db mt5 f14">maxlength="20", lang="zh"(2个字母1个汉字)</span>
                            </div>
                        </ui-contents>
                        <ui-contents>
                            <label>证件照<span class="red abs">*</span></label>
                            <div>
                                <label for="validateFile" class="ui-button">上传照片</label>
                                <input type="hidden" id="inputImgUrl">
                            </div>
                        </ui-contents>
                        <ui-contents>
                            <label>备注</label>
                            <div>
                                <div class="ui-textarea-x" style="max-width:500px;">
                                    <textarea id="txtCount" is="ui-textarea" minlength="5" maxlength="200" rows="5" placeholder="如果输入，至少5个字">测试</textarea>
                                </div>
                                <span class="gray db mt5 f14">minlength="5", maxlength="200"</span>
                            </div>
                        </ui-contents>
                        <ui-contents>
                            <span>&nbsp;</span>
                            <div>
                                <input type="checkbox" id="checkAgree" is="ui-checkbox" required><label class="ml5 f14" for="checkAgree">我已阅读本规范内容</label>
                            </div>
                        </ui-contents>
                        <ui-contents>
                            <span>&nbsp;</span>
                            <div>
                                <button type="submit" is="ui-button" data-type="primary">&emsp;提交&emsp;</button>
                                <button type="reset" is="ui-button" plain>重置</button>
                            </div>
                        </ui-contents>
                    </form>
                    <!-- 上传文件的表单 -->
                    <form><input type="file" id="validateFile" class="dn" accept="image/*" hidden></form>
                </div>
                <div slot="code">
                    <pre>// 表单验证
var elePwd = document.querySelector('#inputPwd');
var elePwdAgain = document.querySelector('#inputPwdAgain');

// 文件上传按钮元素
var eleBtnFile = document.querySelector('label[for="file"]');
// 隐藏input框
var eleHiddenFile = document.querySelector('#inputImgUrl');
// 如果选择文件
file.addEventListener('change', function () {
    eleHiddenFile.value = 'xxx.png';
    // 触发change事件执行
    eleHiddenFile.dispatchEvent(new CustomEvent('change'));
});
// 验证绑定
new Validate('#validateForm', function () {
    new Dialog().alert('全部验证通过');
}, {
    // 自定义验证提示和方法
    validate: [{
        id: 'inputBank',
        report: {
            // 改变内置的提示信息为自定义
            patternMismatch: '银行账户只能是16位数值'
        }
    }, {
        id: 'inputPwd',
        method: function (ele) {
            var valueAgain = elePwdAgain.value;
            if (valueAgain &amp;&amp; ele.value != valueAgain) {
                return '前后密码不一致';
            }

            // 再次输入密码样式变化，后一个参数必需
            this.styleError(elePwdAgain, !!elePwdAgain.value);
        }
    }, {
        id: 'inputPwdAgain',
        method: function (ele) {
            if (ele.value != elePwd.value) {
                return '前后密码不一致';
            }
            // 输入密码样式变化，后一个参数必需
            // 否则会和上面验证来回执行导致死循环
            this.styleError(elePwd, !!elePwd.value);
        }
    }, {
        id: 'inputImgUrl',
        method: function (ele) {
            // ele指存放身份证图片地址的hidden类型的input框
            // 隐藏元素无法定位，转移提示元素给按钮
            ele.dataTarget = eleBtnFile;
            if (ele.value == '') {
                return '尚未上传证件照';
            }
        }
    }]
});</pre>
                </div>
            </code-run>

            
            
            <p>证件照验证相关HTML代码：</p>
            <pre>&lt;label for="file" class="ui-button"&gt;上传照片&lt;/label&gt;
&lt;input type="hidden" id="inputImgUrl"&gt;

&lt;!-- 上传文件的表单 --&gt;
&lt;form&gt;&lt;input type="file" id="file" accept="image/*"&gt;&lt;/form&gt;</pre>
            <p>注意，上面 <code>hidden</code> 类型的 <code>&lt;input&gt;</code> 元素自定义的 <code>method</code> 方法实现功能是为空验证，该功能也可以通过添加 <code>required</code> 属性实现，如下：</p>
            <pre>&lt;input type="hidden" id="inputImgUrl" required&gt;</pre>
            <p>然后使用<code>report</code>参数改变提示内容。例如：</p>
            <pre>// required设置时候的处理
{
    id: 'inputImgUrl',
    report: {
        // 指定值缺失时候的提示文字
        valueMissing: '尚未上传头像'
    }
}</pre>

            <h3>语法和参数</h3>

            <h4>语法</h4>
            <pre>new Validate(element, callback, options);</pre>

            <h4>参数</h4>
            <p>其中：</p>
            <dl>
                <dt>element</dt>
                <dd>必须。Element|String。可以是 DOM 元素，也可以是 DOM 元素的选择器。通常指 <code>&lt;form&gt;</code> 元素。</dd>
                <dt>callback</dt>
                <dd>可选。Function。全部验证通过之后的回调方法。其中上下文 <code>this</code> 指当前实例对象，支持一个参数，表示 <code>element</code> 参数对应的元素。</dd>
                <dt>options</dt>
                <dd>可选。Object。可选参数，具体见下表：</dd>
            </dl>
            <table width="100%" class="ui-table">
              <tr>
                <th scope="col" width="70">参数名称</th>
                <th scope="col" width="70">支持类型</th>
                <th scope="col" width="110">默认值</th>
                <th scope="col">释义</th>
              </tr>
              <tr>
                <td>validate</td>
                <td>Array<br>Object</td>
                <td>[]</td>
                <td>自定义提示和验证方法。为对象数组集。如 <code>[{}, {}]</code>。如果仅有一个数组项，也可以直接使用该数组项作为参数。
                    <p>本参数要点较多，本文档有专门深入介绍，<a href="#validityStateH4">详见这里</a>。</p>
               </td>
              </tr>
              <tr>
                <td>multiple</td>
                <td>Boolean</td>
                <td>true</td>
                <td>提交时候是全部错误高亮，还是仅仅第一个。</td>
              </tr>
              <tr>
                <td>immediate</td>
                <td>Boolean</td>
                <td>true</td>
                <td>是否在表单提交后开启即时验证。</td>
              </tr>
              <tr>
                <td>label</td>
                <td>Boolean</td>
                <td>true</td>
                <td>是否使用关联 <code>&lt;label&gt;</code> 元素中裸露的文字作为提示关键字，会自动过滤冒号，此参数非常实用。</td>
              </tr>
              <tr>
            </table>

            <h4>事件</h4>

            <p>参与表单验证的所有控件元素均支持原生的 <code>valid</code> 和 <code>invalid</code> 事件，分别在验证通过和验证不通过的时候触发（本文档页面对底部案例有使用示意）。</p>

            <p>另外，当所有表单控件元素都验证通过的时候，会触发表单元素自定义的 <code>valid</code>事件，例如：</p>
            <pre>form.addEventListener('valid', function () {
    // 表单验证通过                
});</pre>

            <h4 id="validityStateH4">validate可选参数深入</h4>
            <p>validate 参数实际使用多这样：</p>
            <pre>new Validate('formId', {
    validate: [{
        id: 'inputId',
        report: {
            /* 设置错误类型对应提示 */
        },
        method: function () {
            /* 额外自定义验证方法，返回customError提示文字 */
        }
    }]
});</pre>
            <p>如果 validate 参数值的数组项只有一个，可以直接使用该数组项作为参数，示意：</p>
            <pre>new Validate('formId', {
    validate: {
        id: 'inputId',
        report: {},
        method: function () {}
    }
});</pre>
            <h5>数组对象深入</h5>
            <p>数组项为纯对象，支持下面几个参数：</p>
            <dl>
                <dt>id</dt>
                <dd>必需。String。目标验证输入框或选择框元素的<code>id</code>属性值。</dd>
                <dt>report</dt>
                <dd>可选。Object。自定义出错的提示文字。支持以下提示字段：</dd>
                <dd>
                    <pre>{
    badInput: '提示文字...'
    customError: '...'
    patternMismatch: '...'
    rangeOverflow: '...'
    rangeUnderflow: '...'
    stepMismatch: '...'
    tooLong: '...'
    tooShort: '...'
    typeMismatch: '...'
    valueMissing: '...'
}</pre>
                    <p>例如 <code>valueMissing</code> 的值缺失。所有这些提示字段源自浏览器原生验证的 ValidityState 对象。每个字段对应的含义可以参见这篇文章：<a href="https://www.zhangxinxu.com/wordpress/?p=8895" target="_blank">https://www.zhangxinxu.com/wordpress/?p=8895</a></p>
                    <p>所有提示字段值还支持 Function 类型，用在需要动态返回提示内容的场景。</p>
                </dd>
                <dt>method</dt>
                <dd>可选。Function。自定义验证方法。</dd>
                <dd><p>其中上下文 this 指当前实例对象，支持一个参数，为当前验证元素。</p></dd>
                <dd><p>返回错误提示内容字符串，或 <code>{ customError: '...' }</code> 对象。</p></dd>
                <dd><p>其他返回值（包括 <code>undefined</code>）都认为是验证通过。</p></dd>
            </dl>

            <h5>自定义提示案例</h5>
            <p>下面有一个普普通通的输入框和一个普普通通的按钮：</p>
            <ui-flex><input id="inputA" class="ui-input mr15" required> <button id="buttonA" is="ui-button" type="primary">点我</button></ui-flex>
            <pre>&lt;input class="ui-input" required&gt;
&lt;button is="ui-button" type="primary"&gt;点我&lt;/button&gt;</pre>
            <p>点击按钮，会触发验证提示，这里直接使用原生语法示意，如下：</p>
            <pre>button.addEventListener('click', function () {
    input.reportValidity();
});</pre>

            <p>如果输入框里面没有值，此时出现的提示文案是内置的“请填写此字段”。</p>

            <p>如果我们想要改变出现的提示文案，可以有下面两种方法：</p>
            <ol>
                <li>借助Validate实例方法，我们可以随便找个输入框的祖先元素当作表单元素（实际开发外面需要有<code>&lt;form&gt;</code>元素，这里示意省略了）。
                    <pre>new Validate(input.parentElement, {
    validate: {
        id: 'input',
        report: {
            valueMissing: '主人，这里还没有输入内容，喵~'
        }
    }
});
button.addEventListener('click', function () {
    input.reportValidity();
});</pre>
                    <p>效果如下：</p>
                    <ui-flex><input id="inputB" class="ui-input mr15" required> <button id="buttonB" is="ui-button" type="primary">点我</button></ui-flex>
                </li>
                <li>使用原生的 API 语法 <code>Element.setCustomValidity()</code>，如下：
                    <pre>input.setCustomValidity({
    valueMissing: '主人，请输入内容，喵呜~'
});
button.addEventListener('click', function () {
    input.reportValidity();
});</pre>
                    <p>效果如下：</p>
                    <ui-flex><input id="inputC" class="ui-input mr15" required> <button id="buttonC" is="ui-button" type="primary">点我</button></ui-flex>
                </li>
            </ol>

            <p>然而，实际开发，其实使用更多的是借助 <code>&lt;label&gt;</code> 元素重置宽泛的提示。<a href="#labelCount">详见这里</a>。</p>

            <h5>自定义验证方法案例</h5>
            <p>演示 <code>method</code> 参数以及隐藏元素的提示功能实现，此参数的基本用法其实在一开始的“测试与演示”案例那里有演示，这里再细化下。</p>
            <ol>
                <li><p>首先演示下基本功能：</p>
            <p>下面有一个普普通通的输入框和一个普普通通的按钮：</p>
            <ui-flex><input id="inputD" class="ui-input mr15"> <button id="buttonD" is="ui-button" type="primary">点我</button></ui-flex>
            <pre>&lt;input class="ui-input"&gt;
&lt;button is="ui-button" type="primary"&gt;点我&lt;/button&gt;</pre>
            <p>此时，我们观察 <code>&lt;input&gt;</code> 输入框对应的 HTML 代码，可以看到没有设置 <code>required</code> 属性，默认状态下，认为是合法的。</p>
            <p>如果我们希望此时内容为空也提示错误，而 HTML 又没法设置，怎么办呢？可以使用 <code>method</code> 参数，JS 代码如下：</p>
            <pre>new Validate(input.parentElement, {
    validate: {
        id: 'input',
        method: function (element) {
            if (element.value.trim() == '') {
                return '这个是必填的哟~';
            }
        }
    }
});
button.addEventListener('click', function () {
    input.reportValidity();
});</pre>
            <p>在本例中，为了演示，所以外面没有 <code>&lt;form&gt;</code> 元素，在这种场景下，想要自定义验证方法，还有更简单的实现。所有的自定义提示和方法都是使用 <code>Element.customValidity</code> 实现的，因此，上面代码我们还可以简化成这样：</p><pre>input.customValidity = {
    method: function (element) {
        if (element.value.trim() == '') {
            return '这个是必填的哟~';
        }
    }
};
button.addEventListener('click', function () {
    input.reportValidity();
});</pre>
                </li>
                <li>然后演示下隐藏元素的提示，有些表单控件是隐藏在页面中的，例如 <code>'hidden'</code> 类型输入框，或者一些很丑的拿不出台面的元素。Validate 组件对 LuLu UI 内置的表单元素已经做了提示元素转移，但是并不能覆盖所有的场景，此时，需要开发人员针对具体的场景进行调整。
                    <p>有两种做法，一是通过 <code>data-target</code> 属性关联，还有一种是在 DOM 对象上使用 dataTarget 属性关联。</p>
                    <p>例如一个更换头像功能，点击按钮图像上会出现提示：</p>
                    <div class="dib tc">
                        <img id="imgE" src="//facepic.qidian.com/qd_face/349573/123/100" alt="默认头像" width="100" height="100">
                        <input id="inputE" type="hidden" data-target="imgE" required>
                        <p>
                            <button id="buttonE" is="ui-button" type="primary">确认更换</button>
                        </p>
                    </div>
                    <p>HTML代码如下：</p>
                    <pre>&lt;img id="img" src="default.png" alt="默认头像"&gt;
&lt;input id="input" type="hidden" data-target="img" required&gt;
&lt;button id="button" is="ui-button" type="primary"&gt;确认更换&lt;/button&gt;</pre>
                    <p>使用了 data-target 将提示定位元素从隐藏的输入框转移为 &lt;img&gt; 图像。此时就可以安心执行<code>reportValidity()</code>方法了。</p>
                    <pre>input.setCustomValidity({
    valueMissing: '尚未上传更换的头像'
});
button.addEventListener('click', function () {
    input.reportValidity();
});</pre>
                    <p>如果 HTML 设置不方便，也可以使用 DOM 对象进行关联：</p>
                    <pre>&lt;img id="img" src="default.png" alt="默认头像"&gt;
&lt;input id="input" type="hidden" required&gt;
</pre>
<pre>input.dataTarget = img;
// 其余代码同上...</pre>
                </li>
            </ol>

            <h3>扩展调用方法</h3>

            <p>为了更好地适应多种使用场景，本组件还支持下面两种调用方法：</p>

            <ol>
                <li>form.validate() 语法；</li>
                <li>is-validate 自定义属性；</li>
            </ol>

            <h4>form.validate() 语法</h4>

            <p><code>form.validate()</code> 语法仅支持 <code>&lt;form&gt;</code> 元素，使用示意：</p>
            <pre>&lt;form id="f0"&gt;
    &lt;input type="search" class="ui-input" required&gt;
    &lt;button type="submit" is="ui-button" type="primary"&gt;搜索&lt;/button&gt;
&lt;/form&gt;</pre>
            <pre>f0.validate();
f0.addEventListener('valid', function () {
    new Dialog().alert('验证通过');
});</pre>

            <form id="f0">
                <input type="search" class="ui-input" required>
                <button type="submit" is="ui-button" type="primary">搜索</button>
            </form>

            <h4>is-validate 自定义属性</h4>

            <p>给任意的元素设置 <code>is-validate</code> 属性，就会自动进行表单验证初始化的设置。</p>
            <p>例如：</p>
            <pre>&lt;form id="f1" is-validate&gt;
    &lt;input type="search" class="ui-input" required&gt;
    &lt;button type="submit" is="ui-button" type="primary"&gt;搜索&lt;/button&gt;
&lt;/form&gt;</pre>
            <pre>f1.addEventListener('valid', function () {
    new Dialog().alert('同样验证通过');
});</pre>
            <form id="f1" is-validate class="ui-flex">
                <input type="search" class="ui-input mr10" required>
                <button type="submit" is="ui-button" type="primary">搜索</button>
            </form>

            <p>当使用 <code>is-validate</code>属 性语法的时候，支持 <code>connected</code> 和 <code>DOMContentLoaded</code> 生命周期事件。</p>

            <h3>document.validate对象</h3>

            <p><code>document.validate</code> 对象是 Validate 组件的核心，或者说 Validate 组件是基于 <code>document.validate</code> 对象封装而来。</p>
            <p>表单验证浏览器内置的三个方法 <code>checkValidity()</code>，<code>reportValidity()</code>，<code>setCustomValidity()</code> 和一个属性 <code>validity</code> 的重置也是基于 <code>document.validate</code> 对象实现。</p>
            <p>因此，了解<code>document.validate</code> 对象有助于实现更定制化的需求。</p>

            <h4>属性</h4>
            <dl>
                <dt>reg, name</dt>
                <dd><code>reg</code>的值是内置表单元素类型对应的正则表达式对象合集。默认值是（点击展开）：<pre style="height: 6em; overflow: hidden;" onclick="this.style.height='';">{
    email: '^[a-z0-9._%-]+@([a-z0-9-]+\\.)+[a-z]{2,4}$',
    number: '^\\-?\\d+(\\.\\d+)?$',
    url: "^(http|https)\\:\\/\\/[a-z0-9\\-\\.]+\\.[a-z]{2,3}(:[a-z0-9]*)?\\/?([a-z0-9\\-\\._\\:\\?\\,\\'\\/\\\\\\+&amp;amp;%\\$#\\=~])*$",
    tel: '^1\\d{10}$',
    zipcode: '^\\d{6}$',
    date: '^\\d{4}\\-(0\\d|1[0-2])\\-([0-2]\\d|3[0-1])$',
    time: '^[0-2]\\d\\:[0-5]\\d$',
    hour: '^[0-2]\\d\\:00$',
    minute: '^[0-2]\\d\\:[0-5]\\d$'
}</pre></dd>
                <dd><code>name</code>值是内置表单元素类型对应的中文名称对象合集。默认值是（点击展开）：<pre style="height: 6em; overflow: hidden;" onclick="this.style.height='';">{
    email: '邮箱',
    tel: '手机号码',
    url: '网址',
    zipcode: '邮编',
    password: '密码',
    number: '数值',
    range: '数值',
    date: '日期',
    year: '年份',
    month: '月份',
    hour: '小时',
    minute: '分钟',
    time: '时间'
}</pre></dd>
                <dd>
                    <p>我们可以使用这两个属性扩展自定义的验证类型，例如，扩展一个身份证输入框。</p>
                    <pre>document.validate.reg.idcard = '^[1-9]\\d{5}[1-9]\\d{3}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])\\d{3}([0-9]|[Xx])$';
document.validate.name.idcard = '身份证';</pre>
                    <p>此时，我们就获得了 <code>type="idcard"</code> 类型的输入框。点击下面的“验证”按钮，看看提示信息是不是包含了“身份证”关键字：</p>
                    <ui-flex><input id="inputF" type="idcard" class="ui-input mr10" required> <button id="buttonF" is="ui-button" type="primary">验证</button></ui-flex>
                    <p>代码如下：</p>
                    <pre>&lt;input id="input" type="idcard" class="ui-input" required&gt;
&lt;button id="button" is="ui-button" type="primary"&gt;验证&lt;/button&gt;</pre>
                </dd>
                <dt>focusable</dt>
                <dd>出错提示出现的时候，输入框的值是否框选。<code>true</code> 表示框选，<code>0</code> 和 <code>false</code> 表示忽略。此属性有成熟的内置逻辑，不建议自己尝试使用。</dd>
            </dl>

            <h4>方法</h4>
            <dl>
                <dt>selectRange(element, start, end)</dt>
                <dd>设置 element 从 start 到 end 位置文字选中。</dd>
                <dt>getTel(tel)</dt>
                <dd>返回准确的连续 11 位号码，过滤短横线或者 +86 这些不需要的字符。</dd>
                <dt>getType(element)</dt>
                <dd>返回元素准确的类型。</dd>
                <dt>getLength</dt>
                <dd>返回元素准确的字符长度。</dd>
                <dt>getReportText(element)</dt>
                <dd>返回元素对应的错误提示信息，如果元素验证通过，没有错误，则返回值是空字符串。</dd>
                <dt>getTarget(element)</dt>
                <dd>返回准确的 ErrorTip 提示的目标元素。</dd>
                <dt>getMissingState(element)</dt>
                <dd>返回元素值是否缺失的验证状态。返回值：<pre>{
    // 如果值缺失，下面的false应该是true
    valueMissing: false
}</pre></dd>
                <dt>getMismatchState(element, regex, params)</dt>
                <dd>返回元素的值和 <code>type</code> 类型对应正则，或者和 <code>pattern</code> 正则的验证状态。没有错误的返回值是：<pre>{
    patternMismatch: false,
    typeMismatch: false
}</pre></dd>
                <dd><code>regex</code> 和 <code>params</code> 两个参数表示指定正则表达式，和<code>i</code>，<code>g</code>这类正则参数。本组件并未用到这两个参数。</dd>
                <dt>getRangeState(element)</dt>
                <dd>返回元素的值是否超出 <code>max</code>，<code>min</code> 以及 <code>step</code> 属性限定的范围。验证无误的返回值是：<pre>{
    badInput: false,
    rangeOverflow: false,
    rangeUnderflow: false,
    stepMismatch: false
}</pre></dd>
                <dt>getLengthState(element)</dt>
                <dd>返回元素的字符数量是否超出 <code>maxlength</code> 和 <code>minlength</code> 的范围限制。验证无误的返回值是：<pre>{
    tooLong: false,
    tooShort: false
}</pre></dd>
                <dt>getValidity(element)</dt>
                <dd>返回元素完整的验证状态结果。就是上面四个方法返回值的合集。另外，会多一个 <code>valid</code> 属性，如果为 <code>true</code>，表示验证通过，如果为 <code>false</code>，则表示验证不通过。规则和规范标准一致。</dd>
                <dt>isMissing(element)</dt>
                <dd>返回布尔值。是否值缺失。</dd>
                <dt>isMismatch(element)</dt>
                <dd>返回布尔值。是否值不匹配。</dd>
                <dt>isOut(element)</dt>
                <dd>返回布尔值。是否值范围超出。</dd>
                <dt>isOverflow(element)</dt>
                <dd>返回布尔值。是否值的字符长度范围超出。</dd>
                <dt>checkValidity(element)</dt>
                <dd>返回布尔值。是否值验证不通过。可以看成是上面四个验证方法的集合。</dd>
                <dt>setCustomValidity(element, content)</dt>
                <dd>设置自定义错误的提示文字。也就是 customError 错误类型的提示内容。其中，<code>content</code>必需。</dd>
                <dt>reportValidity(element, content)</dt>
                <dd>在准确的位置显示出错提示，并红色高亮元素。其中，<code>content</code> 参数可选。本组件内部并未用到该参数。本方法返回布尔值，表示验证是否成功的结果。</dd>
                <dt>styleError(element, valid)</dt>
                <dd>根据元素的验证状态，显示或关闭出错样式。其中 <code>valid</code> 是可选参数，布尔值。如果指定 <code>valid</code> 的值，则不会再次执行元素的合法性判断，直接使用这个参数值进行样式控制。</dd>
                <dt>errorTip(element, content)</dt>
                <dd>在准确的位置显示出错提示。</dd>
            </dl>

            <h3>原生属性和方法</h3>
            <p>本组件对原生的表单验证方法进行了重置，以便更好地和 LuLu UI 体系结合。分别如下：</p>
            <h4>属性</h4>
            <dl>
                <dt>Element.validity</dt>
                <dd>返回当前表单控件元素的验证状态对象。例如：<pre>badInput: false
customError: false
patternMismatch: false
rangeOverflow: false
rangeUnderflow: false
stepMismatch: false
tooLong: false
tooShort: false
typeMismatch: false
valueMissing: false
// 验证通过与否
valid: true</pre></dd>
                <dt>Element.validationMessage</dt>
                <dd>返回当前表单控件元素的验证提示信息，如果是空字符串，则表示验证无误</dd>
                <dt>Element.willValidate</dt>
                <dd>当前表单控件元素是否可以参与验证，此属性本组件并未重定义，完全原生，因此，返回值和本组件行为可能会有不一致的地方。例如 hidden 类型的输入框返回值是 false，但是本组件对于hidden类型的输入框也进行了验证。</dd>
            </dl>
            <h4>方法</h4>
            <dl>
                <dt>Element.checkValidity()</dt>
                <dd>返回当前表单控件元素或者表单元素的验证结果。返回值是布尔值。<code>true</code> 表示验证通过。</dd>
                <dt>Element.reportValidity(content)</dt>
                <dd>显示当前表单控件元素的错误提示，如果没有错误，则不出现提示。会使用 LuLu UI 内置的 UI。其中，<code>content</code> 参数可选。</dd>
                <dt>Element.setCustomValidity(content)</dt>
                <dd>设置当前表单控件元素自定义的提示内容。其中，<code>content</code> 参数必需。可以是字符串，表示所有的错误类型都使用这个提示内容；也可以是纯对象，指定具体错误类型的提示内容。例如：<pre>input.setCustomValidity({
    valueMissing: '主人，请输入内容，喵呜~'
});</pre></dd>
            </dl>
            <p>原生属性和方法虽然使用方便，但是实际开发往往需要即时验证，实时更新输入框的验证状态。此时，还是需要用到 Validate 实例方法。也就是下面要介绍内容。</p>

            <h3>实例对象属性和方法</h3>
            <p>实例对象下面两种语法都能获取，如下：</p>
            <pre>var myValidate = new Validate(eleForm);</pre>
            <p>或者是：</p>
            <pre>new Validate(eleForm);
var myValidate = eleForm.data.validate;</pre>
            <p>myValidate暴露了如下属性和方法：</p>
            <pre>{
    // 元素
    element: {
        form: null
    },
    // 自定义提示和方法的数据
    data: [],
    // 是否阻止表单验证，
    // 如果为true，表单提交行为不会被阻止
    stopValidate: false,
    // 一些布尔标志量
    params: {
        // 是否一次验证多个
        multiple: true,
        // 是否即时验证
        immediate: true,
        // 是否提示关键字取自label标签
        label: true
    },
    // 即时验证细节处理
    immediate: function () {},
    // 返回布尔值，当前表单元素是否验证通过
    // 此方法内部有出错提示显示的逻辑处理
    checkValidity: function () {},
    // 显示出错提示，同Element.reportValidity(content)
    reportValidity: function (element, content) {}
}</pre>
            <p>另外，eleForm 元素上有一个名为 <code>isImmediated</code> 的标志量，表示表单元素是否已经开启了即时校验验证。</p>


            <h3>更多应用案例</h3>

            <h4 id="labelCount">活用label参数优化提示</h4>
            <p>借助 <code>&lt;label&gt;</code> 元素可以让我们的提示信息更加友好。</p>
            <p>例如，点击下面的提交按钮预览效果：</p>
            <form id="commentForm">
                <fieldset class="pl20 pr20">
                    <legend>&lt;label&gt; 提示和计数位置自定义演示</legend>
                    <div class="f14 mt10 mb5"><label for="comment"><span>请填写</span>评语：</label>（不超过50字，已输入<label for="comment" class="ui-textarea-count">0</label>字）</div>
                    <textarea id="comment" maxlength="50" rows="3" required is="ui-textarea"></textarea>
                    <p><button type="submit" class="ui-button" disabled data-type="primary">提交</button></p>
                </fieldset>
            </form>
            <p>HTML如下：</p>
            <pre>&lt;form id="commentForm"&gt;
    &lt;label for="comment"&gt;&lt;span&gt;请填写&lt;/span&gt;评语：&lt;/label&gt;（不超过50字，已输入&lt;label for="comment" class="ui-textarea-count"&gt;0&lt;/label&gt;字）
    &lt;div class="ui-textarea" style="max-width:300px;"&gt;
        &lt;textarea id="comment" maxlength="50" rows="3" required&gt;&lt;/textarea&gt;
    &lt;/div&gt;
    &lt;button type="submit" class="ui-button" disabled data-type="primary"&gt;提交&lt;/button&gt;
&lt;/form&gt;</pre>

            <p>JS就是简单初始化：</p>
            <pre>// label提示和计数高级用法示意
new Validate('#commentForm', function () {
    new Dialog().alert('评论成功', {
        type: 'success'
    });
});</pre>
            <h5>关于提示优化</h5>
            <p>在这个例子中，值缺失的提示不是“请填写此字段”，而是“评论不能为空”，显然更友好，那这个友好的提示是从哪里来的呢，JS代码中并没有看到端倪。</p>
            <p>实际上是在HTML中设置的，先看关键代码部分：</p>
            <pre>&lt;label for="comment"&gt;&lt;span&gt;请填写&lt;/span&gt;评语：&lt;/label&gt;</pre>
            <p>Validate 组件会通过与表单控件元素关联的 <code>&lt;label&gt;</code> 元素寻找提示关键字。关键字提取规则有4个小点：</p>
            <ol>
                <li>只选取裸露的文字。例如虽然上面 <code>&lt;label&gt;</code> 元素完整文本是“请填写此字段”，但是由于“请填写”外面有 <code>&lt;span&gt;</code> 标签，于是被忽略（请填写外面的 span 是故意添加的）；</li>
                <li>会过滤冒号和数字，于是提示关键字不是“评语：”，而是“评语”；</li>
                <li>多个关联<code>&lt;label&gt;</code>元素取长度最长的文本作为关键字，因此后面计数的 <code>&lt;label&gt;</code> 元素会被忽略；</li>
                <li>提示关键字小于2个字符被忽略。</li>
            </ol>
            <p>根据近20多个大小项目实践，上面规则没有出现提示异常。</p>

            <h5>关于计数</h5>
            <p>输入框有 <code>maxlength</code> 或 <code>minlength</code> 就会触发计数功能。</p>

            <h4>非表单元素的验证</h4>
            <p>建议所有的验证和提交走原生的 <code>&lt;form&gt;</code> 元素。</p>
            <p>如果遇到特殊场景，无法使用 <code>&lt;form&gt;</code> 元素，不要担心，Validate.js 也是支持的。</p>
            <p>参考下面的例子，一个 <code>&lt;input&gt;</code> 框在普通的 <code>&lt;div&gt;</code> 中有个普通的 <code>&lt;button&gt;</code> 标签按钮。</p>

            <div id="notForm" class="pt10 pb10 bgwh">
                <input type="search" is="ui-input" required>
                <button class="ui-button ml10" type="primary">搜索</button>
            </div>

            <pre>&lt;div id="notForm"&gt;
    &lt;span class="ui-input ui-search-input"&gt;
        &lt;input type="search" required>
        &lt;span class="ui-icon-search">搜索&lt;/span&gt;
    &lt;/span&gt;
    &lt;button is="ui-button" type="primary"&gt;搜索&lt;/button&gt;
&lt;/div&gt;</pre>

            <p>JS代码如下：</p>
            <pre>// 非表单元素验证
var notForm = document.querySelector('#notForm');
var notFormValidate = new Validate(notForm, null);
button.addEventListener('click', function () {
    if (notFormValidate.checkValidity()) {
        new Dialog().alert('无表单验证通过');
    }
});</pre>
            <p>区别在于需要自己绑定点击事件以及回车事件（原生表单内置的，这里回车没支持），然后执行全局验证方法 <code>myValidate.checkValidity()</code>，如果返回是 <code>true</code>，则表示整个表单验证通过。</p>

            <h4>一开始就开启失焦验证</h4>
            <p>这种交互和浏览器内置的交互行为是相悖的，我个人是极力反对的，但是架不住一些难搞的产品经理，希望一开始就算用户没提交，也要开始验证。可以执行一次 <code>myValidate.immediate()</code> 方法。</p>
            <p>如果产品经理希望一开始就验证，但不希望这么重（上面即时验证开启后，focus 聚焦也会提示），则需要自己添加失焦事件，可以参考下面案例。</p>

            <form id="blurForm">
                <input type="search" class="ui-input" required>
                <button type="submit" class="ui-button ml10" data-type="primary">搜索</button>
            </form>
            <pre>// 一开始就失焦验证
var eleBlurForm = document.querySelector('#blurForm');
var blurValidate = new Validate(eleBlurForm, function () {
    new Dialog().alert('验证通过');
});
// 添加失焦验证事件处理
eleBlurForm.querySelectorAll('input, select, textarea').forEach(function (eleInput) {
    eleInput.addEventListener('blur', function () {
        // 需要还没有开启即时验证
        if (!eleBlurForm.isImmediated) {
            // 提示时候内容不选中
            document.validate.focusable = 0;
            // 提示
            blurValidate.reportValidity(eleInput);
        }
    });
});</pre>

            <h4>验证成功后走原生提交</h4> 
            <p>这个使用实例对象的 <code>stopValidate</code>属性实现：</p>
            <form id="submitForm" class="ui-flex" style="gap:.5rem;">
                <input type="search" name="s" is="ui-input" required>
                <button type="submit" is="ui-button" data-type="primary">搜索</button>
            </form>
            <pre>new Validate('#submitForm', function (validate) {
    validate.stopValidate = true;
    this.submit();
});</pre>

            <h4>JS单独触发某个输入框的验证</h4>
            <form id="validForm" class="ui-grid" style="gap:.5rem;">
                <label for="">用户名：</label><input class="ui-input" required>
                <label for="">密&emsp;码：</label><input type="password" class="ui-input" required pattern="\w{6,}">
                
                <label for="inputCode" flex="none">验证码：</label>
                <ui-flex>
                    <input id="inputCode" class="ui-input mr10 w100" pattern="\d{4}" required>
                    <button id="validButton" type="button" class="ui-button" data-type="danger">单独验证验证码</button>
                </ui-flex>
                <label></label>
                <button type="submit" is="ui-button" type="primary">提交</button>
            </form>
            <p>关键部分源码如下：</p>
            <pre>验证码：&lt;input id="code" pattern="\d{4}" required&gt;
&lt;button id="button" type="button" class="ui-button" data-type="danger"&gt;单独验证验证码&lt;/button&gt;</pre>
            <pre>var aloneValidate = new Validate('#validForm');
var eleCode = document.querySelector('#code');
button.addEventListener('click', function () {
    aloneValidate.reportValidity(eleCode);
});</pre>
            <p>除了使用实例对象上的<code>reportValidity()</code>方法，也可以使用控件元素上原生的<code>reportValidity()</code>方法，例如：</p>
            <pre>button.addEventListener('click', function () {
    document.querySelector('#code').reportValidity();
});</pre>

            <h4>使用文字进行错误提示</h4>

            <p>有时候，设计师设计的出错提示是内嵌在页面中的一段文字，而不是浮层提示，本组件也是可以支持的，但是，虽说支持，其实是有能力实现这样的效果，组件本文并未内置这样的交互支持，因为这样的设计是和 LuLu UI 的理念不相符的。</p>

            <p>实现原理：</p>
            <ol>
                <li>隐藏 ErrorTip 效果；</li>
                <li>通过输入框的 valid/invalid 事件控制提示文字的显隐；</li>
            </ol>

            <p>比方说下面这个例子：</p>

            <iframe id="validFrame" frameborder="0" width="100%" height="120"></iframe>

            <p>代码示意如下：</p>
            <pre>/* 隐藏红色出错提示 */
.ui-tips-error { 
    display: none;
}</pre>
            <pre>&lt;form id="validateForm"&gt;
    &lt;p&gt;
        邮箱：&lt;input type="email" id="email" is="ui-input" name="email" required&gt;
        &lt;output id="result" style="color:red;"&gt;&lt;/output&gt;
    &lt;/p&gt;
    &lt;button type="submit" is="ui-button" type="primary"&gt;提交&lt;/button&gt;
&lt;/form&gt;</pre>
            <pre>new Validate('#validateForm');
// 自定义成功和出错提示处理
email.addEventListener('valid', function () {
    result.innerHTML = '';
});
email.addEventListener('invalid', function () {
    result.innerHTML = this.validationMessage;
});</pre>

            <div class="contributors">
                <svg><use xlink:href="#icon-persons"></use></svg> <h6 class="contributors-h">本页贡献者：</h6><p id="contributorsP" class="contributors-p">zhangxinxu</p>
            </div>
        </article>
    </main>
    <!-- 侧边栏 -->
    <!-- 侧边栏 -->
<aside id="aside" class="aside">
    <div class="aside_main">
    	<dl class="aside_dl">
        	<dt class="aside_dt">关于</dt>
            <dd><a href="./about.html" class="aside_nav ">设计思考</a></dd>
            <dd><a href="./use.html" class="aside_nav ">快速上手</a></dd>
        </dl>
        <dl class="aside_dl">
            <dt class="aside_dt">样式</dt>
            <dd><a href="./colour.html" class="aside_nav ">颜色与主题</a></dd>
            <dd><a href="./layout.html" class="aside_nav ">既定布局</a></dd>
        </dl>
        <dl class="aside_dl">
            <dt class="aside_dt">元素衍生</dt>
            <dd><a href="./hr.html" class="aside_nav ">Hr 分隔线</a></dd>
            <dd><a href="./button.html" class="aside_nav ">Button 按钮</a></dd>

            <dd><a href="./input.html" class="aside_nav ">Input 文本框</a>
                <!-- <dd-li>
                    <a href="./input-password.html" class="aside_nav ">Password 密码框</a>
                </dd-li> -->
            </dd>
            <dd><a href="./textarea.html" class="aside_nav ">Textarea 文本域</a></dd>

            <dd><a href="./checkbox.html" class="aside_nav ">Checkbox 多选</a>
                <dd-li>
                    <a href="./checkbox-switch.html" class="aside_nav ">Switch 开关</a>
                </dd-li>
            </dd>
            <dd><a href="./radio.html" class="aside_nav ">Radio 单选</a></dd>

            <dd><a href="./progress.html" class="aside_nav ">Progress 进度</a></dd>

            <dd><a href="./select.html" class="aside_nav ">Select 下拉框</a></dd>
            <dd><a href="./range.html" class="aside_nav ">Range 范围选择</a>
                <dd-li>
                    <a href="./range-star.html" class="aside_nav ">Star 评分</a>
                </dd-li>
            </dd>
            <dd><a href="./datetime.html" class="aside_nav ">DateTime 日期选择</a></dd>
            <dd><a href="./form.html" class="aside_nav ">Form 表单</a>
                <dd-li><a href="./errortip.html" class="aside_nav ">ErrorTip 提示</a></dd-li>
                <dd-li><a href="./validate.html" class="aside_nav active">Validate 表单验证</a></dd-li>
            </dd>
        </dl>
        <dl class="aside_dl">
            <dt class="aside_dt">交互</dt>
            <dd><a href="./loading.html" class="aside_nav ">Loading 效果</a>
                <!-- <dd-li>
                    <a href="" class="aside_nav ">Pulldown 下拉</a>
                </dd-li> -->
            </dd>
            <dd><a href="./overlay.html" class="aside_nav ">Overlay 覆盖</a>
                <dd-li><a href="./popup.html" class="aside_nav ">Popup 弹出</a></dd-li>
                <dd-li><a href="./dialog.html" class="aside_nav ">Dialog 弹框</a></dd-li>
            </dd>
            
            <dd><a href="./float.html" class="aside_nav ">Float 浮层</a>
                <dd-li>
                    <a href="./toast.html" class="aside_nav ">Toast 提示</a>
                </dd-li>
                <dd-li>
                    <a href="./lighttip.html" class="aside_nav ">LightTip 提示</a>
                </dd-li>
                <dd-li>
                    <a href="./followtext.html" class="aside_nav ">FollowText 提示</a>
                </dd-li>
            </dd>

            <dd><a href="./pagination.html" class="aside_nav ">Pagination 分页</a></dd>

            <dd><a href="./drop.html" class="aside_nav ">Drop 下拉</a>
                <dd-li>
                    <a href="drop-list.html" class="aside_nav ">Drop 列表</a>
                </dd-li>
            </dd>
            
            <dd>
                <a href="./rel.html" class="aside_nav ">Rel 切换</a>
                <dd-li>
                    <a href="./tab.html" class="aside_nav ">Tab 选项卡</a>
                </dd-li>
            </dd>
            <dd>
                <a href="./snap.html" class="aside_nav ">Snap 滚动</a>
                <dd-li>
                    <a href="snap-swipe.html" class="aside_nav ">SnapSwipe 轮播</a>
                </dd-li>
                <dd-li>
                    <a href="snap-cell.html" class="aside_nav ">SnapCell 滑动单元格</a>
                </dd-li>
                <dd-li>
                    <a href="snap-tab.html" class="aside_nav ">SnapTab 滑动式选项卡</a>
                </dd-li>
            </dd>
            
        </dl>
    </div>
</aside>
<script>(function () {
    // 记住滚动位置
    var eleAside = document.getElementById('aside');

    eleAside.addEventListener('click', function () {
        sessionStorage.asideScrollTop = this.scrollTop;
    });

    eleAside.scrollTop = sessionStorage.asideScrollTop;
    // IE这里设置可能没有用
    if (eleAside.scrollTop != sessionStorage.asideScrollTop) {
        setTimeout(function () {
            eleAside.scrollTop = sessionStorage.asideScrollTop;
        }, 1);
    }

    // 滚动条设置判断
    var div = document.createElement('div');
    div.style.width = '100px';
    div.style.height = '100px';
    div.style.overflow = 'auto';
    div.style.position = 'absolute';
    div.style.left = '-199px';
    var p = document.createElement('p');
    p.style.height = '120px';
    p.innerHTML = 'haha';
    div.appendChild(p);
    document.body.appendChild(div);
    if (p.clientWidth != 100) {
        eleAside.className += ' scrollbar';
    }
    document.body.removeChild(div);
})();
</script>
</div>

<a href="#" id="backtop" class="backtop"></a>
<!-- 底部 -->
<script src="../hope/assets/js/mockup.js"></script>
<script src="../hope/assets/js/highlight.min.js"></script>
<script>
document.querySelectorAll('pre').forEach((el) => {
    hljs.highlightElement(el);
});
</script>
</body>
</html>

<script type="module" src="https://qidian.gtimg.com/lulu/hope/ui/Select/index.js"></script>
<script type="module" src="https://qidian.gtimg.com/lulu/hope/ui/DateTime/index.js"></script>
<script type="module" src="https://qidian.gtimg.com/lulu/hope/ui/Validate/index.js"></script>
<script type="module" src="https://qidian.gtimg.com/lulu/hope/ui/Dialog/index.js"></script>

<script type="module">
// 表单验证
var elePwd = document.querySelector('#inputPwd');
var elePwdAgain = document.querySelector('#inputPwdAgain');

// 文件上传按钮元素
var eleBtnFile = document.querySelector('label[for="validateFile"]');
// 隐藏input框
var eleHiddenFile = document.querySelector('#inputImgUrl');
// 如果选择文件
document.querySelector('#validateFile').addEventListener('change', function () {
    eleHiddenFile.value = 'https://bookcover.yuewen.com/qdbimg/349573/1010868264/180';

    eleHiddenFile.dispatchEvent(new CustomEvent('change'));
});
// 验证绑定
new Validate('#validateForm', function () {
    new Dialog().alert('全部验证通过');
}, {
    validate: [{
        id: 'inputBank',
        report: {
            // 改变内置的提示信息为自定义
            patternMismatch: '银行账户只能是16位数值'
        }
    }, {
        id: 'inputPwd',
        method: function (ele) {
            var valueAgain = elePwdAgain.value;
            if (valueAgain && ele.value != valueAgain) {
                return '前后密码不一致';
            }

            // 再次输入密码样式变化，后一个参数必须
            document.validate.styleError(elePwdAgain, !!elePwdAgain.value);
        }
    }, {
        id: 'inputPwdAgain',
        method: function (ele) {
            if (ele.value != elePwd.value) {
                return '前后密码不一致';
            }
            // 输入密码样式变化，后一个参数必须
            // 否则会和上面验证来回执行导致死循环
            document.validate.styleError(elePwd, !!elePwd.value);
        }
    }, {
        id: 'inputImgUrl',
        method: function (ele) {
            // el指存放身份证图片地址的hidden类型的input框
            // 隐藏元素无法定位，转移提示元素给按钮
            ele.dataTarget = eleBtnFile;
            if (ele.value == '') {
                return '尚未上传证件照';
            }
        }
    }]
});

inputPwd.addEventListener('valid', function () {
    console.log('密码验证OK');
});
inputPwd.addEventListener('invalid', function () {
    console.log(this.validationMessage);
});

buttonA.addEventListener('click', function () {
    inputA.reportValidity();
});

new Validate(inputB.parentElement, {
    validate: {
        id: 'inputB',
        report: {
            valueMissing: '主人，这里还没有输入内容，喵~'
        }
    }
});
buttonB.addEventListener('click', function () {
    inputB.reportValidity();
});

inputC.setCustomValidity({
    valueMissing: '主人，请输入内容，喵呜~'
});
buttonC.addEventListener('click', function () {
    inputC.reportValidity();
});

new Validate(inputD.parentElement, {
    validate: {
        id: 'inputD',
        method: function (input) {
            if (input.value.trim() == '') {
                return '这个是必填的哟~';
            }
        }
    }
});
buttonD.addEventListener('click', function () {
    inputD.reportValidity();
});

inputE.setCustomValidity({
    valueMissing: '尚未上传更换的头像'
});
buttonE.addEventListener('click', function () {
    inputE.reportValidity();
});

// label提示和计数高级用法示意
new Validate('#commentForm', function () {
    new Dialog().alert('评论成功', {
        type: 'success'
    });
});

// 扩展输入框类型
document.validate.reg.idcard = '^[1-9]\\d{5}[1-9]\\d{3}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])\\d{3}([0-9]|[Xx])$';
document.validate.name.idcard = '身份证';

buttonF.addEventListener('click', function () {
    inputF.reportValidity();
});

// form.validate()方法
f0.validate();
f0.addEventListener('valid', function () {
    new Dialog().alert('验证通过');
});
f1.addEventListener('valid', function () {
    new Dialog().alert('同样验证通过');
});


// 非表单元素验证
var notForm = document.querySelector('#notForm');
var notFormValidate = new Validate(notForm, null);
notForm.querySelector('button').addEventListener('click', function () {
    if (notFormValidate.checkValidity()) {
        new Dialog().alert('无表单验证通过');
    }
});

// 一开始就失焦验证
var eleBlurForm = document.querySelector('#blurForm');
var blurValidate = new Validate(eleBlurForm, function () {
    new Dialog().alert('验证通过');
});
// 添加失焦验证事件处理
eleBlurForm.querySelectorAll('input, select, textarea').forEach(function (eleInput) {
    eleInput.addEventListener('blur', function () {
        if (!eleBlurForm.isImmediated) {
            // 如果没有开启即时验证
            document.validate.focusable = 0;

            blurValidate.reportValidity(eleInput);
        }
    });
});

// 走原生提交
new Validate('#submitForm', function (form) {
    this.stopValidate = true;

    form.submit();
});

// 单独验证
var aloneValidate = new Validate('#validForm');
var eleInputCode = document.querySelector('#inputCode');
document.querySelector('#validButton').addEventListener('click', function () {
    aloneValidate.reportValidity(eleInputCode);
});

document.querySelectorAll('article a[href^="#"]').forEach(function (eleLink) {
    eleLink.addEventListener('click', function (event) {
        var eleTarget = document.querySelector(this.getAttribute('href'));
        if (eleTarget) {
            window.scrollTopTo(eleTarget.offsetTop);

            event.preventDefault();
        }
    });
});

// 使用内联文本进行出错提示
let prefixUrl = 'https://qidian.gtimg.com/lulu';
if (/localhost/.test(location.host)) {
    prefixUrl = 'http://localhost:10086/theme'
}
let htmlInFrame = `
<link rel="stylesheet" href="${prefixUrl}/edge/css/common/form.css">
<link rel="stylesheet" href="${prefixUrl}/edge/css/common/ui/Tips.css">
<style>.ui-tips-error{display:none;}</style>
<form id="validateForm">
    <p>
        邮箱：<input type="email" id="email" is="ui-input" name="email" required>
        <output id="result" style="color:red;"></output>
    </p>
    <button type="submit" is="ui-button" type="primary">提交</button>
</form>
<script type="module" src="${prefixUrl}/edge/js/common/ui/Validate.js"><\/script>
<script type="module">
new Validate('#validateForm');
// 自定义成功和出错提示处理
email.addEventListener('valid', function () {
    result.innerHTML = '';
});
email.addEventListener('invalid', function () {
    result.innerHTML = this.validationMessage;
});
<\/script>`;
validFrame.src = URL.createObjectURL(new Blob([htmlInFrame], {
  'type': 'text/html'
}));
</script>
